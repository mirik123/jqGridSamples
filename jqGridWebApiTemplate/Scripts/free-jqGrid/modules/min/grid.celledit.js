(function(h){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],h):"object"===typeof exports?h(require("jquery")):h(jQuery)})(function(h){var u=h.jgrid,C=function(){var a=h.makeArray(arguments);a.unshift("");a.unshift("");a.unshift(this.p);return u.feedback.apply(this,a)},D=function(a,c){var e=this.grid.fbRows;return h((null!=e&&e[0].cells.length>c?e[a.rowIndex]:a).cells[c])};u.extend({editCell:function(a,c,e){return this.each(function(){var g=
this,d=h(g),f=g.p,l,b,k,r;l=g.rows;if(g.grid&&!0===f.cellEdit&&null!=l&&null!=l[a]&&(a=parseInt(a,10),c=parseInt(c,10),!isNaN(a)&&!isNaN(c))){var t=l[a],m=null!=t?t.id:null,n=h(t),p=parseInt(f.iCol,10),A=parseInt(f.iRow,10),w=h(l[A]),v=f.savedRow;if(null!=m){f.selrow=m;f.knv||d.jqGrid("GridNav");if(0<v.length){if(!0===e&&a===A&&c===p)return;d.jqGrid("saveCell",v[0].id,v[0].ic)}else setTimeout(function(){h("#"+u.jqID(f.knv)).attr("tabindex","-1").focus()},1);r=f.colModel[c];l=r.name;if("subgrid"!==
l&&"cb"!==l&&"rn"!==l){k=D.call(g,t,c);t=r.editable;h.isFunction(t)&&(t=t.call(g,{rowid:m,iCol:c,iRow:a,name:l,cm:r,mode:"cell"}));var x=d.jqGrid("getGuiStyles","select","edit-cell"),y=d.jqGrid("getGuiStyles","hover","selected-row");if(!0!==t||!0!==e||k.hasClass("not-editable-cell"))0<=p&&0<=A&&(D.call(g,w[0],p).removeClass(x),w.removeClass(y)),k.addClass(x),n.addClass(y),b=k.html().replace(/&#160;/ig,""),C.call(g,"onSelectCell",m,l,b,a,c);else{0<=p&&0<=A&&(D.call(g,w[0],p).removeClass(x),w.removeClass(y));
k.addClass(x);n.addClass(y);r.edittype||(r.edittype="text");n=r.edittype;try{b=h.unformat.call(g,k,{rowId:m,colModel:r},c)}catch(q){b="textarea"===n?k.text():k.html()}f.autoEncodeOnEdit&&(b=u.oldDecodePostedData(b));v.push({id:a,ic:c,name:l,v:b});if("&nbsp;"===b||"&#160;"===b||1===b.length&&160===b.charCodeAt(0))b="";h.isFunction(f.formatCell)&&(p=f.formatCell.call(g,m,l,b,a,c),void 0!==p&&(b=p));C.call(g,"beforeEditCell",m,l,b,a,c);r=h.extend({},r.editoptions||{},{id:a+"_"+l,name:l,rowId:m,mode:"cell"});
var B=u.createEl.call(g,n,r,b,!0,h.extend({},u.ajaxOptions,f.ajaxSelectOptions||{})),n=k;(p=!0===f.treeGrid&&l===f.ExpandColumn)&&(n=k.children("span.cell-wrapperleaf,span.cell-wrapper"));n.html("").append(B).attr("tabindex","0");p&&h(B).width(k.width()-k.children("div.tree-wrap").outerWidth());u.bindEv.call(g,B,r);setTimeout(function(){h(B).focus()},1);h("input, select, textarea",k).bind("keydown",function(e){27===e.keyCode&&(0<h("input.hasDatepicker",k).length?h(".ui-datepicker").is(":hidden")?
d.jqGrid("restoreCell",a,c):h("input.hasDatepicker",k).datepicker("hide"):d.jqGrid("restoreCell",a,c));if(13===e.keyCode&&!e.shiftKey)return d.jqGrid("saveCell",a,c),!1;if(9===e.keyCode){if(g.grid.hDiv.loading)return!1;e.shiftKey?d.jqGrid("prevCell",a,c):d.jqGrid("nextCell",a,c)}e.stopPropagation()});C.call(g,"afterEditCell",m,l,b,a,c);d.triggerHandler("jqGridAfterEditCell",[m,l,b,a,c])}f.iCol=c;f.iRow=a}}}})},saveCell:function(a,c){return this.each(function(){var e=this,g=h(e),d=e.p,f=u.info_dialog,
l=u.jqID;if(e.grid&&!0===d.cellEdit){var b=g.jqGrid("getGridRes","errors"),k=b.errcap,r=g.jqGrid("getGridRes","edit").bClose,t=d.savedRow,m=1<=t.length?0:null;if(null!==m){var n=e.rows[a],p=n.id,A=h(n),w=d.colModel[c],v=w.name,x,y=D.call(e,n,c),B={},q=u.getEditedValue.call(e,y,w,B);if(q!==t[m].v){x=g.triggerHandler("jqGridBeforeSaveCell",[p,v,q,a,c]);void 0!==x&&(q=x);h.isFunction(d.beforeSaveCell)&&(x=d.beforeSaveCell.call(e,p,v,q,a,c),void 0!==x&&(q=x));var F=u.checkValues.call(e,q,c,void 0,void 0,
{oldValue:t[m].v,newValue:q,cmName:v,rowid:p,iCol:c,iRow:a,cm:w,tr:n,td:y,mode:"cell"}),n=w.formatoptions||{};if(!0===F[0]){m=g.triggerHandler("jqGridBeforeSubmitCell",[p,v,q,a,c])||{};h.isFunction(d.beforeSubmitCell)&&((m=d.beforeSubmitCell.call(e,p,v,q,a,c))||(m={}));0<h("input.hasDatepicker",y).length&&h("input.hasDatepicker",y).datepicker("hide");"date"===w.formatter&&!0!==n.sendFormatted&&(q=h.unformat.date.call(e,q,w));if("remote"===d.cellsubmit)if(d.cellurl){var z={};z[v]=q;var b=d.prmNames,
n=b.oper,E=e.grid.hDiv;z[b.id]=u.stripPref(d.idPrefix,p);z[n]=b.editoper;z=h.extend(m,z);d.autoEncodeOnEdit&&h.each(z,function(a,d){h.isFunction(d)||(z[a]=u.oldEncodePostedData(d))});g.jqGrid("progressBar",{method:"show",loadtype:d.loadui,htmlcontent:u.defaults.savetext||"Saving..."});E.loading=!0;h.ajax(h.extend({url:h.isFunction(d.cellurl)?d.cellurl.call(e,d.cellurl,a,c,p,q,v):d.cellurl,data:u.serializeFeedback.call(e,d.serializeCellData,"jqGridSerializeCellData",z),type:"POST",complete:function(b){g.jqGrid("progressBar",
{method:"hide",loadtype:d.loadui});E.loading=!1;if((300>b.status||304===b.status)&&(0!==b.status||4!==b.readyState)){var m=g.triggerHandler("jqGridAfterSubmitCell",[e,b,z.id,v,q,a,c])||[!0,""];!0===m[0]&&h.isFunction(d.afterSubmitCell)&&(m=d.afterSubmitCell.call(e,b,z.id,v,q,a,c));!0===m[0]?(g.jqGrid("setCell",p,c,q,!1,!1,!0),y.addClass("dirty-cell"),A.addClass("edited"),C.call(e,"afterSaveCell",p,v,q,a,c),t.splice(0,1)):(f.call(e,k,m[1],r),g.jqGrid("restoreCell",a,c))}},error:function(b,m,n){h("#lui_"+
l(d.id)).hide();E.loading=!1;g.triggerHandler("jqGridErrorCell",[b,m,n]);h.isFunction(d.errorCell)?d.errorCell.call(e,b,m,n):f.call(e,k,b.status+" : "+b.statusText+"<br/>"+m,r);g.jqGrid("restoreCell",a,c)}},u.ajaxOptions,d.ajaxCellOptions||{}))}else try{f.call(e,k,b.nourl,r),g.jqGrid("restoreCell",a,c)}catch(G){}"clientArray"===d.cellsubmit&&(g.jqGrid("setCell",p,c,"select"===w.edittype&&"select"!==w.formatter?B.text:q,!1,!1,!0),y.addClass("dirty-cell"),A.addClass("edited"),C.call(e,"afterSaveCell",
p,v,q,a,c),t.splice(0,1))}else try{setTimeout(function(){f.call(e,k,q+" "+F[1],r)},100),g.jqGrid("restoreCell",a,c)}catch(G){}}else g.jqGrid("restoreCell",a,c)}setTimeout(function(){h("#"+l(d.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(a,c){return this.each(function(){var e=this.p,g=this.rows[a],d=g.id,f,l;if(this.grid&&!0===e.cellEdit){var b=e.savedRow;f=D.call(this,g,c);if(1<=b.length){if(h.isFunction(h.fn.datepicker))try{h("input.hasDatepicker",f).datepicker("hide")}catch(k){}g=
e.colModel[c];!0===e.treeGrid&&g.name===e.ExpandColumn?f.children("span.cell-wrapperleaf,span.cell-wrapper").empty():f.empty();f.attr("tabindex","-1");f=b[0].v;l=g.formatoptions||{};"date"===g.formatter&&!0!==l.sendFormatted&&(f=h.unformat.date.call(this,f,g));h(this).jqGrid("setCell",d,c,f,!1,!1,!0);C.call(this,"afterRestoreCell",d,f,a,c);b.splice(0,1)}setTimeout(function(){h("#"+e.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(a,c){return this.each(function(){var e=h(this),g=this.p,
d=!1,f,l,b,k=this.rows;if(this.grid&&!0===g.cellEdit&&null!=k&&null!=k[a]){for(f=c+1;f<g.colModel.length;f++)if(b=g.colModel[f],l=b.editable,h.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:f,iRow:a,name:b.name,cm:b,mode:"cell"})),!0===l){d=f;break}!1!==d?e.jqGrid("editCell",a,d,!0):0<g.savedRow.length&&e.jqGrid("saveCell",a,c)}})},prevCell:function(a,c){return this.each(function(){var e=h(this),g=this.p,d=!1,f,l,b,k=this.rows;if(this.grid&&!0===g.cellEdit&&null!=k&&null!=k[a]){for(f=c-1;0<=f;f--)if(b=
g.colModel[f],l=b.editable,h.isFunction(l)&&(l=l.call(this,{rowid:k[a].id,iCol:f,iRow:a,name:b.name,cm:b,mode:"cell"})),!0===l){d=f;break}!1!==d?e.jqGrid("editCell",a,d,!0):0<g.savedRow.length&&e.jqGrid("saveCell",a,c)}})},GridNav:function(){return this.each(function(){function a(a,d,b){a=e.rows[a];if("v"===b.substr(0,1)){var c=k.clientHeight,g=k.scrollTop,h=a.offsetTop+a.clientHeight,f=a.offsetTop;"vd"===b&&h>=c&&(k.scrollTop+=a.clientHeight);"vu"===b&&f<g&&(k.scrollTop-=a.clientHeight)}"h"===b&&
(b=k.scrollLeft,d=a.cells[d],a=d.offsetLeft,d.offsetLeft+d.clientWidth>=k.clientWidth+parseInt(b,10)?k.scrollLeft+=d.clientWidth:a<b&&(k.scrollLeft-=d.clientWidth))}function c(a,b){var c=0,e,g=d.colModel;if("lft"===b)for(c=a+1,e=a;0<=e;e--)if(!0!==g[e].hidden){c=e;break}if("rgt"===b)for(c=a-1,e=a;e<g.length;e++)if(!0!==g[e].hidden){c=e;break}return c}var e=this,g=h(e),d=e.p,f=e.grid,l,b;if(f&&!0===d.cellEdit){var k=f.bDiv;d.knv=d.id+"_kn";var r=h("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+
d.knv+"'></div></div>");h(r).insertBefore(f.cDiv);h("#"+d.knv).focus().keydown(function(h){var f=parseInt(d.iRow,10),k=parseInt(d.iCol,10);b=h.keyCode;"rtl"===d.direction&&(37===b?b=39:39===b&&(b=37));switch(b){case 38:0<f-1&&(a(f-1,k,"vu"),g.jqGrid("editCell",f-1,k,!1));break;case 40:f+1<=e.rows.length-1&&(a(f+1,k,"vd"),g.jqGrid("editCell",f+1,k,!1));break;case 37:0<=k-1&&(l=c(k-1,"lft"),a(f,l,"h"),g.jqGrid("editCell",f,l,!1));break;case 39:k+1<=d.colModel.length-1&&(l=c(k+1,"rgt"),a(f,l,"h"),g.jqGrid("editCell",
f,l,!1));break;case 13:0<=k&&0<=f&&g.jqGrid("editCell",f,k,!0);break;default:return!0}return!1})}})},getChangedCells:function(a){var c=[];a||(a="all");this.each(function(){var e=this,g=e.p,d=u.htmlDecode,f=e.rows;e.grid&&!0===g.cellEdit&&h(f).each(function(l){var b={};if(h(this).hasClass("edited")){var k=this;h(this.cells).each(function(c){var t=g.colModel[c],m=t.name,n=D.call(e,k,c);if("cb"!==m&&"subgrid"!==m&&"rn"!==m&&("dirty"!==a||n.hasClass("dirty-cell")))try{b[m]=h.unformat.call(e,n[0],{rowId:f[l].id,
colModel:t},c)}catch(p){b[m]=d(n.html())}});b.id=this.id;c.push(b)}})});return c}})});
//# sourceMappingURL=grid.celledit.map
